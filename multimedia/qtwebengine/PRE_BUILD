default_pre_build &&

sed -i -e 's|use_jumbo_build=true|use_jumbo_build=false|' src/buildtools/config/common.pri &&

sed -e '/link_pulseaudio/s/false/true/' -i src/3rdparty/chromium/media/media_options.gni &&

sed -e '/^MODULE_VERSION/s/5.*/5.15.10/' -i .qmake.conf &&

sed -i 's/NINJAJOBS/NINJA_JOBS/' src/core/gn_run.pro &&

find -type f -name "*.pr[io]" | xargs sed -i -e 's|INCLUDEPATH += |&$$QTWEBENGINE_ROOT/include |' &&

sed -e 's/\^(?i)/(?i)^/' -i src/3rdparty/chromium/tools/metrics/ukm/ukm_model.py &&
sed -e "s/'rU'/'r'/" -i src/3rdparty/chromium/tools/grit/grit/util.py &&

# So it doesn't link to the old version.
if [ -e /usr/lib/qt5/libQt5WebEngineCore.so ]; then
  mv -v /usr/lib/qt5/libQt5WebEngineCore.so{,.old}
fi &&

#Quoting the LFS folks here;
#Although the patches used in this module ensures git is not invoked during the build, the build system has
#labyrinthine rules of byzantine complexity, and in particular trying to build without two .git directories
#will lead to it eventually falling into unexpected and unbuildable code which references a private header
#that has not been created. Avoid this by creating the required directories
mkdir -pv .git src/3rdparty/chromium/.git
